<script>
    function getLocation() {
        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                document.getElementById("Latitude").value = position.coords.latitude;
                document.getElementById("Longitude").value = position.coords.longitude;
            }, function(error) {
                alert("فشل في تحديد الموقع. تأكد من السماح للموقع في المتصفح.");
            });
        } else {
            alert("المتصفح لا يدعم تحديد الموقع الجغرافي.");
        }
    }

    function sendToExcel(event) {
        event.preventDefault();

        const name = document.getElementById("Name").value;
        const nationalId = document.getElementById("NationalID").value;
        const latitude = document.getElementById("Latitude").value;
        const longitude = document.getElementById("Longitude").value;

        const data = {
            name: name,
            id: nationalId,
            latitude: latitude,
            longitude: longitude
        };

        fetch("https://script.google.com/macros/s/AKfycbxbjk1Peyy5sD1VdFN8QJsclCCUTo4q9B1bWObgMMvR-B2C8_aS0lr-CywoByXb0FDiEg/exec", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify(data)
        })
        .then(response => {
            if (response.ok) {
                alert("✅ تم إرسال البيانات بنجاح");
                document.getElementById("registrationForm").reset();
            } else {
                alert("❌ حدث خطأ أثناء الإرسال (مرفوض من الخادم)");
            }
        })
        .catch(error => {
            alert("⚠️ فشل الاتصال: " + error);
        });
    }
</script>
